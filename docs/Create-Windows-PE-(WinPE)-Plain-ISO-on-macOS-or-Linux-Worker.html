
<!doctype html>
<html lang="en">




<head>
    <title>How to Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker - Attune Automation</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="title"
          content="How to Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker - Attune Automation">
    <meta name="description"
          content="">
    <meta name="robots"
          content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large">

    <meta property="og:locale" content="en_AU" />
    <meta property="og:type" content="article" />
    <meta property="og:title"
          content="HowTo Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker - Attune Automation" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="Attune Automation" />
    <meta property="article:section" content="IT Instruction" />

    <meta name="twitter:title"
          content="How to Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker - Attune Automation" />
    <meta name="twitter:description" content="" />

    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-180x180.png">
    <meta name="msapplication-TileImage" content="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-270x270.png">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="styles/style.css">

    <!-- Google tag (gtag.js) -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=G-5TZQZNDJCD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-5TZQZNDJCD');
    </script>
</head>


<body>

<!-- Project NavBar -->

<div class="bg-white border-bottom box-shadow sticky-top mb-3">
<div class="container px-0">
    <div class="row px-0">
        <div class="col d-flex flex-column flex-lg-row align-items-center px-0
            py-3">
            <a class="navbar-brand my-0 mr-lg-auto"
                  href="https://www.servertribe.com/"
                  target="_blank">
                    <img
                        src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                        alt="Attune - Powered by ServerTribe"
                        class="img-fluid navbar-img">
            </a>
            <nav class="my-2 my-lg-0 mr-lg-3">
                <a class="p-2 text-dark" href="http://doc.servertribe.com/"
                   target="_blank">
                    Documentation
                </a>
                <a class="p-2 text-dark"
                   href="https://discord.com/invite/3YpJsagqUn"
                   target="_blank">
                    Discord
                </a>
                <a class="p-2 text-dark" href="https://github.com/Attune-Automation"
                   target="_blank">
                    GitHub
                </a>
                <a class="p-2 text-dark" href="https://www.servertribe.com/learn/"
                   target="_blank">
                    Learn
                </a>
            </nav>
            <a class="btn btn-outline-primary"
               href="https://www.servertribe.com/download-attune-registration/"
               target="_blank">
                Download NOW!
            </a>
        </div>
    </div>
</div></div>

<!-- Project breadcrumbs -->

<!-- Project breadcrumbs -->
<div class="container px-0">
    <div class="row">
        <nav class="col px-0" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="index.html">
                    Automate Windows Installation with autounattend
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <strong>Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker</strong>
                </li>
            </ol>
        </nav>
    </div>
</div>

<!-- Blueprint Header -->

<div class="container px-0">
    <!-- Blueprint name and description -->
    <div class="row">
        <div class="col px-0">
            <h1 class="text-left">
                How to Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker
            </h1>
        </div>
    </div>

<!-- Blueprint Description -->
    <div class="row pt-4">
        <div class="col-6 px-0">
            <h6 class="text-left">
                This documentation is generated by
                <a href="https://www.servertribe.com/"
                    class="badge badge-primary"
                    target="_blank">
                    Attune
                </a>
            </h6>
        </div>
        <div class="col-6 align-self-end text-right px-0">
            <h6 class="text-right">
                <a href="https://www.youtube.com/@servertribe"
                    class="badge badge-secondary"
                    target="_blank">
                    YouTube
                </a>
                <a href="https://github.com/Attune-Automation"
                    class="badge badge-secondary"
                    target="_blank">
                    GitHub
                </a>
                <a href="https://discord.com/invite/3YpJsagqUn"
                    class="badge badge-secondary"
                    target="_blank">
                    Discord
                </a>
                <a href="https://www.linkedin.com/company/servertribe/"
                    class="badge badge-secondary"
                    target="_blank">
                    LinkedIn
                </a>
                <a href="http://doc.servertribe.com/"
                    class="badge badge-secondary"
                    target="_blank">
                    Documentation
                </a>
            </h6>
        </div>
    </div>
    <hr>
</div>

<div class="documentation">
    <div class="container px-0">
        <div class="row">

<!-- Blueprint ToC -->


            <div class="toc col-lg-2 px-0 pr-5">
                <div class="container px-0 pt-3">
                    <p class="pb-2">
                        <strong>Contents</strong>
                    </p>
                    <p class="text-muted">
                        <a href="#top">
                            <strong>Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker</strong>
                        </a>
                    </p>


    
        

                    <p class="text-muted pt-2">
                        <a href="#confirmwinpeplainisodoesnotexistonmacosorlinuxworker">
                            <strong>Step 1 -</strong> Confirm WinPE plain ISO does not exist on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#cleanupbuildfilesforwinpeplainisocreationonmacosorlinuxworker">
                            <strong>Step 2 -</strong> Cleanup Build Files for WinPE plain ISO Creation on macOS or Linux Worker
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#unmountwinpeuefimountonmacosorlinuxworker">
                            <strong>Step 2.1 -</strong> Unmount WinPE UEFI Mount on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#unmountwindowsisoonmacosorlinuxworker">
                            <strong>Step 2.2 -</strong> Unmount Windows ISO on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#setwritepermissionstowinpestagingonmacosorlinuxworker">
                            <strong>Step 2.3 -</strong> Set Write Permissions to winpe_staging on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#cleanbuilddirectoryonmacosorlinuxworker">
                            <strong>Step 2.4 -</strong> Clean Build Directory on macOS or Linux Worker
                        </a>
                    </p>


        

                    <p class="text-muted pt-2">
                        <a href="#deploywin2019dvdisotobuildwinpeisodirectoryonmacosorlinuxworker">
                            <strong>Step 3 -</strong> Deploy Win2019 DVD ISO to build-winpe-iso directory on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#extractwindowsbootimgfrombuildwinpeisodirectoryforbiosbuildonmacosorlinuxworker">
                            <strong>Step 4 -</strong> Extract Windows boot.img from build-winpe-iso directory for BIOS build on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#mountwinserverdvdisoonmacosorlinuxworker">
                            <strong>Step 5 -</strong> Mount Win Server DVD ISO on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#extractwinpeisofromwinimgdirectoryonmacosorlinuxworker">
                            <strong>Step 6 -</strong> Extract WinPE ISO from winimg Directory on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#extractwinpeisotostagingfolderonbuildwinpeisoonmacosorlinuxworker">
                            <strong>Step 7 -</strong> Extract WinPE ISO to Staging Folder on build-winpe-iso on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#copyfilesformkwinpeimgcompatibilitytowinpestagingonmacosorlinuxworker">
                            <strong>Step 8 -</strong> Copy Files for mkwinpeimg Compatibility to WinPE Staging on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#movebootimgtowinpestagingforbiosbuildonmacosorlinuxworker">
                            <strong>Step 9 -</strong> Move boot.img to winpe_staging for BIOS build on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#deletesetupexefrombootwimonmacosorlinuxworker">
                            <strong>Step 10 -</strong> Delete setup.exe from boot.wim on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#optimizebootwimonmacosorlinuxworker">
                            <strong>Step 11 -</strong> Optimize boot.wim on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#createwinpeplainbiosisofromwinpestagingonmacosorlinuxworker">
                            <strong>Step 12 -</strong> Create winpe_plain_bios.iso from winpe_staging on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#putthewinpeplainuefiisocontenttogetheronlinuxworker">
                            <strong>Step 13 -</strong> Put the winpe_plain_uefi.iso content together on Linux Worker
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#copywindowsefifilestowinpestagingonmacosorlinuxworker">
                            <strong>Step 13.1 -</strong> Copy Windows EFI Files to WinPE Staging on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#changeownershipofwinpestagingdirectorytoattuneonmacosorlinuxworker">
                            <strong>Step 13.2 -</strong> Change Ownership of winpe_staging Directory to attune on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#createwinpeplainuefiisoonmacosorlinuxworker">
                            <strong>Step 13.3 -</strong> Create winpe_plain_uefi.iso on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#mountwinpeplainuefiisoonmacosorlinuxworker">
                            <strong>Step 13.4 -</strong> Mount winpe_plain_uefi.iso on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#movewinpestagingtouefimountonmacosorlinuxworker">
                            <strong>Step 13.5 -</strong> Move WinPE Staging to UEFI Mount on macOS or Linux Worker
                        </a>
                    </p>


        

                    <p class="text-muted pt-2">
                        <a href="#cleanupbuildfilesforwinpeplainisocreationonmacosorlinuxworker">
                            <strong>Step 14 -</strong> Cleanup Build Files for WinPE plain ISO Creation on macOS or Linux Worker
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#unmountwinpeuefimountonmacosorlinuxworker">
                            <strong>Step 14.1 -</strong> Unmount WinPE UEFI Mount on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#unmountwindowsisoonmacosorlinuxworker">
                            <strong>Step 14.2 -</strong> Unmount Windows ISO on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#setwritepermissionstowinpestagingonmacosorlinuxworker">
                            <strong>Step 14.3 -</strong> Set Write Permissions to winpe_staging on macOS or Linux Worker
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#cleanbuilddirectoryonmacosorlinuxworker">
                            <strong>Step 14.4 -</strong> Clean Build Directory on macOS or Linux Worker
                        </a>
                    </p>



                </div>
            </div>

<!-- Blueprint Contents -->
            <div class="col-lg-8 pt-3">
                <div class="container">


        <div class="jumbotron">
            <p class="display-3 text-center">
                <strong>Automate This</strong>
            </p>
            <p class="lead text-center">
                Use the <strong>Attune GUI</strong> for your Scripts
            </p>
            <p class="lead">
                <ol>
                    <a href="https://www.servertribe.com/download-attune-registration/"
                        target="_blank">
                        <span class="badge badge-primary">1</span>
                        Download Attune
                        <i class="fa-solid fa-download fa-beat-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://github.com/attune-Automation/"
                        target="_blank">
                        <span class="badge badge-primary">2</span>
                         Copy the Attune Project URL
                         <i class="fa-brands fa-github fa-fade"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://servertribe-attune.readthedocs.io/en/latest/howto/design_workspace/clone_project.html"
                        target="_blank">
                        <span class="badge badge-primary">3</span>
                        Clone the Project in Attune
                         <i class="fa-solid fa-book fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=GCWDI29rDV0"
                        target="_blank">
                        <span class="badge badge-primary">4</span>
                        Plan your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=b7DhFcURkZg"
                        target="_blank">
                        <span class="badge badge-primary">5</span>
                        Run your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
            </p>
            <p class="lead text-center">
                You've automated: <strong>Create Windows PE (WinPE) Plain ISO on macOS or Linux Worker</strong>
            </p>
            <hr class="my-4 text-center">
            <div class="col px-0">
                <p class="text-center">
                    Get the most out of automation with our get started
                    videos, product demonstrations, and more.
                </p>
                <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://www.servertribe.com/learn/"
                       target="_blank"
                       role="button">
                        Learn Attune Automation
                    </a>
                </p>
            </div>
        </div>

        <div class="row">
            <p>The following steps will guide you through the manual process.</p>
        </div>

<!-- Blueprint Steps -->


        



                    <div class="row pt-5">
                        <h3 id="confirmwinpeplainisodoesnotexistonmacosorlinuxworker">
                            <a href="#confirmwinpeplainisodoesnotexistonmacosorlinuxworker">
                                <strong>Step 1 -</strong> Confirm WinPE plain ISO does not exist on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Checks if the WinPE plain BIOS ISO <code>{automationWorkerLinuxBaseDirectory}/winpe_plain_bios.iso</code> exists.</p>
<p>If it does, prints a message to ask user to confirm to delete it if they want to recreate it.</p>
<p>Only applies to BIOS kickstarts. Only runs if the parameter <code>kickstartedBootLoaderIsBios</code> is set <code>true</code>.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if [[ {kickstartedBootLoaderIsBios} == {kickstartedBootLoaderIsUefi} ]]
then

    echo &quot;Check the plan parameters&quot;
    echo &quot;UEFI and BIOS are both configured as {kickstartedBootLoaderIsBios}.&quot;
    exit 1
    
elif {kickstartedBootLoaderIsBios}
then

    DIRECTORY=&quot;{automationWorkerLinuxBaseDirectory}&quot;
    cd &quot;${DIRECTORY}&quot;
    ISO=&quot;winpe_plain_bios.iso&quot;
    if [[ -f ${ISO} ]]
    then
    
        echo &quot;Please delete ${DIRECTORY}/${ISO} to confirm you want to try again.&quot;
        exit 1
    else
    
        echo &quot;${DIRECTORY}/${ISO} does not exist, good.&quot;
    fi
    
elif {kickstartedBootLoaderIsUefi}
then

    DIRECTORY=&quot;{automationWorkerLinuxBaseDirectory}&quot;
    cd &quot;${DIRECTORY}&quot;
    ISO=&quot;winpe_plain_uefi.iso&quot;
    if [[ -f ${ISO} ]]
    then
    
        echo &quot;Please delete ${DIRECTORY}/${ISO} to confirm you want to try again.&quot;
        exit 1
    else
    
        echo &quot;${DIRECTORY}/${ISO} does not exist, good.&quot;
    fi
    
fi
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="cleanupbuildfilesforwinpeplainisocreationonmacosorlinuxworker">
                            <a href="#cleanupbuildfilesforwinpeplainisocreationonmacosorlinuxworker">
                                <strong>Step 2 -</strong> Cleanup Build Files for WinPE plain ISO Creation on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the temporary build directory.</p>
                            </p>
                        </div>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="unmountwinpeuefimountonmacosorlinuxworker">
                            <a href="#unmountwinpeuefimountonmacosorlinuxworker">
                                <strong>Step 2.1 -</strong> Unmount WinPE UEFI Mount on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>











                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsUefi}
then

    MOUNT_FOLDER=&quot;uefi_mount&quot;
    MOUNT_PATH=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso/${MOUNT_FOLDER}&quot;
    
    if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
    then
        
        if df -h | grep --ignore-case --quiet &quot;${MOUNT_PATH}&quot;
        then
        
            cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
            umount --verbose &quot;${MOUNT_FOLDER}&quot;
            
        else
        
            echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
        fi

    elif [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
    then
    
        if [[ -d &quot;$(echo ${MOUNT_PATH}/*)&quot; ]]
        then
        
            hdiutil detach &quot;$(echo ${MOUNT_PATH}/*)&quot;
        else
        
            echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
        fi

    else
        
        echo &quot;Unsupported operating system.&quot;
    fi
    
else

    echo &quot;Skipping for BIOS boot.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="unmountwindowsisoonmacosorlinuxworker">
                            <a href="#unmountwindowsisoonmacosorlinuxworker">
                                <strong>Step 2.2 -</strong> Unmount Windows ISO on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Unmounts <code>{automationWorkerLinuxBaseDirectory}/build-build-winpe-iso/winimg</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
MOUNT_FOLDER=&quot;winimg&quot;
BUILD_DIRECTORY=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
MOUNT_PATH=&quot;${BUILD_DIRECTORY}/${MOUNT_FOLDER}&quot;

if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
then
    if df -h | grep --ignore-case --quiet &quot;${MOUNT_PATH}&quot;
    then
    
        cd &quot;${BUILD_DIRECTORY}&quot;
        umount --verbose &quot;${MOUNT_FOLDER}&quot;
    else
    
        echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
    fi
elif [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
then
    
    if [[ -d &quot;$(echo ${MOUNT_PATH}/*)&quot; ]]
    then
    
        hdiutil detach $(echo ${MOUNT_PATH}/*)
    else
    
        echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
    fi
    
else
    
    echo &quot;Unsupported operating system.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="setwritepermissionstowinpestagingonmacosorlinuxworker">
                            <a href="#setwritepermissionstowinpestagingonmacosorlinuxworker">
                                <strong>Step 2.3 -</strong> Set Write Permissions to winpe_staging on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>










    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DIR=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;

if [ ! -d ${DIR} ]
then
    echo &quot;Directory ${DIR} does not exist. Skipping.&quot;
else
    cd &quot;${DIR}&quot;
    
    DIR=&quot;winpe_staging&quot;
    if [ ! -d ${DIR} ]
    then
        echo &quot;Directory ${DIR} does not exist. Skipping.&quot;
    else
        echo &quot;Before&quot;
        ls -lh
        
        chmod -R a+w &quot;${DIR}&quot;
        
        echo &quot;After&quot;
        ls -lh
    fi
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="cleanbuilddirectoryonmacosorlinuxworker">
                            <a href="#cleanbuilddirectoryonmacosorlinuxworker">
                                <strong>Step 2.4 -</strong> Clean Build Directory on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the <code>{automationWorkerLinuxBaseDirectory}/build-winpe-iso</code> directory.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DIR=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
[[ -d ${DIR} ]] &amp;&amp; rm -rf ${DIR} &amp;&amp; echo &quot;Removed ${DIR}&quot; || \
    echo &quot;No directory to remove.&quot;
                </code>
            </pre>
        </div>
    </div>






        



                    <div class="row pt-5">
                        <h3 id="deploywin2019dvdisotobuildwinpeisodirectoryonmacosorlinuxworker">
                            <a href="#deploywin2019dvdisotobuildwinpeisodirectoryonmacosorlinuxworker">
                                <strong>Step 3 -</strong> Deploy Win2019 DVD ISO to build-winpe-iso directory on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deploys Windows Server 2019 ISO to <code>{automationWorkerLinuxBaseDirectory}/build-winpe-iso</code>.</p>
                            </p>
                        </div>
                    </div>









    

    



    <div class="row">
        <p>
            <p>Download from https://www.microsoft.com/en-us/evalcenter/download-windows-server-2019.</p>
        </p>
        <p>
            Copy the File(s)
            <strong>Win201_ISO.tar</strong>
            to the target node.
        </p>
        <p>
            <strong>Deploy the File(s)</strong> here:
        </p>
    </div>
    <div class="row py-1">
        <code class="language-bash">
{automationWorkerLinuxBaseDirectory}/build-winpe-iso, relative to the home directory
        </code>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="extractwindowsbootimgfrombuildwinpeisodirectoryforbiosbuildonmacosorlinuxworker">
                            <a href="#extractwindowsbootimgfrombuildwinpeisodirectoryforbiosbuildonmacosorlinuxworker">
                                <strong>Step 4 -</strong> Extract Windows boot.img from build-winpe-iso directory for BIOS build on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Extracts the <code>boot.img</code> from the ISO. This is required for passing to <code>mkisofs</code> to regenerate a bootable BIOS ISO.</p>
<p>Only applies BIOS kickstarts so if the parameter <code>kickstartedBootLoaderIsBios</code> is set <code>true</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsBios}
then

    # Extract the boot.img out of the WinPE ISO
    
    cd {automationWorkerLinuxBaseDirectory}/build-winpe-iso
    
    # Case insensitve globbing
    shopt -s nocaseglob
    
    # Set the filename of the ISO
    F=$(ls *.iso)
    
    # Get the Boot image offset
    OFFSET=`isoinfo -d -i $F | grep Bootoff | cut  -c21-`
    
    # Extract the boot.img.
    dd if=$F of=boot.img bs=2048 count=8 skip=$OFFSET
    
else
    echo &quot;Skipping for UEFI ISO creation.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="mountwinserverdvdisoonmacosorlinuxworker">
                            <a href="#mountwinserverdvdisoonmacosorlinuxworker">
                                <strong>Step 5 -</strong> Mount Win Server DVD ISO on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Mounts the Windows Server ISO to <code>{automationWorkerLinuxBaseDirectory}/build-winpe-iso/winimg</code>.</p>
<p><code>winimg</code> stands for Windows Image.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
FOLDER=&quot;winimg&quot;
mkdir -p &quot;${FOLDER}&quot;

# Case insensitve globbing
shopt -s nocaseglob

ISO=$(ls *SERVER*.iso)

if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
then

    mkdir -p &quot;${FOLDER}/CD&quot;
    mount --options &quot;uid={automationWorkerLinuxUser.user}&quot; \
        --options &quot;gid={automationWorkerLinuxUser.user}&quot; \
        &quot;${ISO}&quot; &quot;${FOLDER}/CD&quot;

elif [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
then
    hdiutil attach ${ISO} -mountroot ${FOLDER}

else
    echo &quot;Unsupported operating system.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="extractwinpeisofromwinimgdirectoryonmacosorlinuxworker">
                            <a href="#extractwinpeisofromwinimgdirectoryonmacosorlinuxworker">
                                <strong>Step 6 -</strong> Extract WinPE ISO from winimg Directory on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Extracts the WinPE image from Windows Server 2019 <code>boot.wim</code> by default at index 2.</p>
<p>Writes this out to <code>winpe.iso</code>.</p>
<p>This is the exact copy of Windows Server 2019's WinPE image which by default will run <code>setup.exe</code> on the Windows Desktop ISO at a higher priority than running <code>startnet.cmd</code>.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;

if [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
then
    sed &#x27;s/getopt -o.*/getopt iso,windows-dir -- $*); then /g&#x27; $(which mkwinpeimg) \
        | sed &#x27;/-- &quot;$@&quot; /d&#x27; \
        | sed &#x27;/,help,version/d&#x27; \
        | sed &#x27;s/eval set -- &quot;$options&quot;/eval set &quot;$options&quot;/g&#x27; \
        &gt; mkwinpeimg
    which sed
    sed -i &#x27;s/while \[ $# -gt 0 \]; do/echo $*;while [ $# -gt 0 ]; do echo $1/g&#x27; mkwinpeimg
    chmod +x mkwinpeimg
    export PATH=&quot;.:$PATH&quot;
fi

mkwinpeimg --iso --windows-dir $(echo winimg/*) -- winpe.iso
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="extractwinpeisotostagingfolderonbuildwinpeisoonmacosorlinuxworker">
                            <a href="#extractwinpeisotostagingfolderonbuildwinpeisoonmacosorlinuxworker">
                                <strong>Step 7 -</strong> Extract WinPE ISO to Staging Folder on build-winpe-iso on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Extract <code>winpe.iso</code> to a <code>winpe_staging</code> folder on macOS or Linux Worker.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerLinuxBaseDirectory}/build-winpe-iso

FOLDER=winpe_staging
mkdir -p &quot;${FOLDER}&quot;

7z x winpe.iso -o&quot;${FOLDER}&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="copyfilesformkwinpeimgcompatibilitytowinpestagingonmacosorlinuxworker">
                            <a href="#copyfilesformkwinpeimgcompatibilitytowinpestagingonmacosorlinuxworker">
                                <strong>Step 8 -</strong> Copy Files for mkwinpeimg Compatibility to WinPE Staging on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>This copies <code>boot/etfsboot.com</code> from the Windows Server 2019 ISO to WinPE's <code>BOOT</code> folder.</p>
<p>This is needed if the WinPE ISO needs to work with future usages with <code>mkwinpeimg</code>.</p>
<p>Otherwise this step is not needed.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;

cp -v &quot;$(find winimg -type f -name etfsboot.com)&quot; &quot;winpe_staging/BOOT&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="movebootimgtowinpestagingforbiosbuildonmacosorlinuxworker">
                            <a href="#movebootimgtowinpestagingforbiosbuildonmacosorlinuxworker">
                                <strong>Step 9 -</strong> Move boot.img to winpe_staging for BIOS build on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Moves <code>boot.img</code> to the <code>winpe_staging</code> folder.</p>
<p><code>mkisofs</code> requires <code>boot.img</code> to make a BIOS bootable ISO.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsBios}
then

    cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
    
    mv -v boot.img winpe_staging
    
else
    echo &quot;Skipping for UEFI ISO creation.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="deletesetupexefrombootwimonmacosorlinuxworker">
                            <a href="#deletesetupexefrombootwimonmacosorlinuxworker">
                                <strong>Step 10 -</strong> Delete setup.exe from boot.wim on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes <code>setup.exe</code> from the extracted WinPE's <code>boot.img</code> at index 2 of the Windows Server 2019 ISO.</p>
<p>By default Windows Server 2019 <code>boot.img</code> contains <code>setup.exe</code> which was designed to work with calling <code>setup.exe</code> which exists at index 1 of Windows Server 2019 image.</p>
<p>As the <code>winpe_staging</code> folder will be used to recreate a WinPE BIOS ISO designed to work with a Samba drive which contains the required <code>setup.exe</code> for these versions of Windows below we no longer need the <code>setup.exe</code> on the WinPE <code>boot.img</code>:</p>
<ol>
<li>Windows Desktop 10</li>
<li>Windows Server 2016</li>
<li>Windows Server 2019</li>
<li>Windows Server 2022</li>
</ol>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerLinuxBaseDirectory}/build-winpe-iso

wimupdate winpe_staging/SOURCES/BOOT.WIM --command=&quot;delete /setup.exe&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="optimizebootwimonmacosorlinuxworker">
                            <a href="#optimizebootwimonmacosorlinuxworker">
                                <strong>Step 11 -</strong> Optimize boot.wim on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Rebuild the entire WIM rather than appending the updated data to the end of it.  Rebuilding the WIM is slower, but will save a little bit of space that would otherwise be left as a hole in the WIM
             file.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerLinuxBaseDirectory}/build-winpe-iso

wimoptimize winpe_staging/SOURCES/BOOT.WIM --recompress
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="createwinpeplainbiosisofromwinpestagingonmacosorlinuxworker">
                            <a href="#createwinpeplainbiosisofromwinpestagingonmacosorlinuxworker">
                                <strong>Step 12 -</strong> Create winpe_plain_bios.iso from winpe_staging on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Creates a WinPE BIOS bootable ISO at <code>{automationWorkerLinuxBaseDirectory}/winpe_plain_bios.iso</code> from the WinPE staging directory <code>{automationWorkerLinuxBaseDirectory}/build-winpe-iso/winpe_staging</code>. </p>
<p>Only applies to UEFI kickstarts. Only run if the parameter <code>kickstartedBootLoaderIsBios</code> is set <code>true</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;

if {kickstartedBootLoaderIsBios} 
then
    ISO_NAME=&quot;winpe_plain_bios.iso&quot;
    
    if [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
    then
        
        export PATH=&quot;${HOME}/Parallels/homebrew/bin:$PATH&quot;
        echo &quot;Using $(which xorriso)&quot;

        xorriso -as mkisofs \
            -b boot.img \
            -no-emul-boot \
            -c BOOT.CAT \
            -iso-level 3 \
            -udf \
            -joliet-long \
            -relaxed-filenames \
            -allow-limited-size \
            -J \
            -full-iso9660-filenames \
            -disable-deep-relocation \
            -omit-version-number \
            -V &quot;KS_WIN&quot; \
            -o &quot;{automationWorkerLinuxBaseDirectory}/${ISO_NAME}&quot; \
            winpe_staging
            
    elif [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
    then
    
        mkisofs \
            -b boot.img \
            -no-emul-boot \
            -c BOOT.CAT \
            -iso-level 3 \
            -udf \
            -joliet-long \
            -relaxed-filenames \
            -allow-limited-size \
            -J \
            -full-iso9660-filenames \
            -disable-deep-relocation \
            -omit-version-number \
            -V &quot;KS_WIN&quot; \
            -o &quot;{automationWorkerLinuxBaseDirectory}/${ISO_NAME}&quot; \
            winpe_staging
    
    else
    
        echo &quot;Unsupported operating system.&quot;
    fi
        
else
    echo &quot;Skipping for UEFI ISO creation.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="putthewinpeplainuefiisocontenttogetheronlinuxworker">
                            <a href="#putthewinpeplainuefiisocontenttogetheronlinuxworker">
                                <strong>Step 13 -</strong> Put the winpe_plain_uefi.iso content together on Linux Worker
                            </a>
                        </h3>
                    </div>






    




    



                    <div class="row pt-5">
                        <h4 id="copywindowsefifilestowinpestagingonmacosorlinuxworker">
                            <a href="#copywindowsefifilestowinpestagingonmacosorlinuxworker">
                                <strong>Step 13.1 -</strong> Copy Windows EFI Files to WinPE Staging on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Relative to the <code>{automationWorkerLinuxBaseDirectory}/build-winpe-iso/winpe</code> directory, copies the EFI files in <code>winimg/efi</code>to <code>winpe_staging</code>.</p>
<p>The <code>efi</code> folder is also copied.</p>
<p>Only applies to UEFI kickstarts so only if <code>kickstartedBootLoaderIsUefi</code> is set to the string <code>true</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsUefi}
then
    
    cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
    
    # Copy EFI Files from Windows ISO
    cp -rv &quot;$(find winimg -type d -name efi)&quot; &quot;winpe_staging&quot;
    
else
    echo &quot;Skipping for BIOS ISO creation.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="changeownershipofwinpestagingdirectorytoattuneonmacosorlinuxworker">
                            <a href="#changeownershipofwinpestagingdirectorytoattuneonmacosorlinuxworker">
                                <strong>Step 13.2 -</strong> Change Ownership of winpe_staging Directory to attune on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>











                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsUefi}
then

    cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
    
    USER=&quot;{automationWorkerLinuxUser.user}&quot;
    GROUP=&quot;$(id -gn {automationWorkerLinuxUser.user})&quot;
    echo &quot;User: $USER, Group: $GROUP&quot;
    
    chown -R -v &quot;$USER:$GROUP&quot; &quot;winpe_staging&quot;
else
    echo &quot;Skipping for BIOS boot.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="createwinpeplainuefiisoonmacosorlinuxworker">
                            <a href="#createwinpeplainuefiisoonmacosorlinuxworker">
                                <strong>Step 13.3 -</strong> Create winpe_plain_uefi.iso on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Referenced from https://apple.stackexchange.com/questions/394372/create-file-that-can-be-mounted</p>
<p>On macOS to see all available filesystems for the <code>-fs</code> switch use:</p>
<pre><code>hdiutil create -help
</code></pre>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsUefi}
then

    cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
    
    bytes=$(du -s winpe_staging | awk &#x27;{print $1 * 1024}&#x27;)
    ((bytes=bytes+10000))
    ISO=&quot;{automationWorkerLinuxBaseDirectory}/winpe_plain_uefi.iso&quot;
    
    if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
    then
        
        mkfs.msdos -v -C &quot;${ISO}&quot; &quot;${bytes}&quot;
    elif [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
    then
    
        megabytes=$(((${bytes} + 1048575) / 1048576))
        echo ${megabytes}
        hdiutil create -fs MS-DOS -size ${megabytes}M -volname &quot;WinPE_Plain_UEFI&quot; &quot;${ISO}&quot;
        hdiutil convert ${ISO}.dmg -format UDTO -o ${ISO}.cdr
        rm -rf ${ISO}.dmg
        mv -v ${ISO}.cdr ${ISO}
    else
        echo &quot;Unsupported operating system.&quot;
    fi
else

    echo &quot;Skipping for BIOS boot.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="mountwinpeplainuefiisoonmacosorlinuxworker">
                            <a href="#mountwinpeplainuefiisoonmacosorlinuxworker">
                                <strong>Step 13.4 -</strong> Mount winpe_plain_uefi.iso on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>











                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsUefi}
then

    cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
    ISO=&quot;{automationWorkerLinuxBaseDirectory}/winpe_plain_uefi.iso&quot;
    FOLDER=&quot;uefi_mount&quot;
    mkdir -p -v ${FOLDER}
    
    if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
    then
        
        mount --verbose &quot;${ISO}&quot; &quot;${FOLDER}/CD&quot;
    
    elif [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
    then
    
        hdiutil attach ${ISO} -mountroot ${FOLDER}
    
    else
        echo &quot;Unsupported operating system.&quot;
    fi
    
else

    echo &quot;Skipping for BIOS boot.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="movewinpestagingtouefimountonmacosorlinuxworker">
                            <a href="#movewinpestagingtouefimountonmacosorlinuxworker">
                                <strong>Step 13.5 -</strong> Move WinPE Staging to UEFI Mount on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>










    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsUefi}
then
        
    cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
    
    # Copy WinPE Files from WinPE ISO
    mv -v winpe_staging/* &quot;$(echo uefi_mount/*)&quot;
else
    echo &quot;Skipping for BIOS boot.&quot;
fi
                </code>
            </pre>
        </div>
    </div>






        



                    <div class="row pt-5">
                        <h3 id="cleanupbuildfilesforwinpeplainisocreationonmacosorlinuxworker">
                            <a href="#cleanupbuildfilesforwinpeplainisocreationonmacosorlinuxworker">
                                <strong>Step 14 -</strong> Cleanup Build Files for WinPE plain ISO Creation on macOS or Linux Worker
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the temporary build directory.</p>
                            </p>
                        </div>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="unmountwinpeuefimountonmacosorlinuxworker">
                            <a href="#unmountwinpeuefimountonmacosorlinuxworker">
                                <strong>Step 14.1 -</strong> Unmount WinPE UEFI Mount on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>










    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
if {kickstartedBootLoaderIsUefi}
then

    MOUNT_FOLDER=&quot;uefi_mount&quot;
    MOUNT_PATH=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso/${MOUNT_FOLDER}&quot;
    
    if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
    then
        
        if df -h | grep --ignore-case --quiet &quot;${MOUNT_PATH}&quot;
        then
        
            cd &quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
            umount --verbose &quot;${MOUNT_FOLDER}&quot;
            
        else
        
            echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
        fi

    elif [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
    then
    
        if [[ -d &quot;$(echo ${MOUNT_PATH}/*)&quot; ]]
        then
        
            hdiutil detach &quot;$(echo ${MOUNT_PATH}/*)&quot;
        else
        
            echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
        fi

    else
        
        echo &quot;Unsupported operating system.&quot;
    fi
    
else

    echo &quot;Skipping for BIOS boot.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="unmountwindowsisoonmacosorlinuxworker">
                            <a href="#unmountwindowsisoonmacosorlinuxworker">
                                <strong>Step 14.2 -</strong> Unmount Windows ISO on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Unmounts <code>{automationWorkerLinuxBaseDirectory}/build-build-winpe-iso/winimg</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
MOUNT_FOLDER=&quot;winimg&quot;
BUILD_DIRECTORY=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
MOUNT_PATH=&quot;${BUILD_DIRECTORY}/${MOUNT_FOLDER}&quot;

if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
then
    if df -h | grep --ignore-case --quiet &quot;${MOUNT_PATH}&quot;
    then
    
        cd &quot;${BUILD_DIRECTORY}&quot;
        umount --verbose &quot;${MOUNT_FOLDER}&quot;
    else
    
        echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
    fi
elif [[ &quot;$(uname)&quot; == &quot;Darwin&quot; ]]
then
    
    if [[ -d &quot;$(echo ${MOUNT_PATH}/*)&quot; ]]
    then
    
        hdiutil detach $(echo ${MOUNT_PATH}/*)
    else
    
        echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
    fi
    
else
    
    echo &quot;Unsupported operating system.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="setwritepermissionstowinpestagingonmacosorlinuxworker">
                            <a href="#setwritepermissionstowinpestagingonmacosorlinuxworker">
                                <strong>Step 14.3 -</strong> Set Write Permissions to winpe_staging on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>










    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DIR=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;

if [ ! -d ${DIR} ]
then
    echo &quot;Directory ${DIR} does not exist. Skipping.&quot;
else
    cd &quot;${DIR}&quot;
    
    DIR=&quot;winpe_staging&quot;
    if [ ! -d ${DIR} ]
    then
        echo &quot;Directory ${DIR} does not exist. Skipping.&quot;
    else
        echo &quot;Before&quot;
        ls -lh
        
        chmod -R a+w &quot;${DIR}&quot;
        
        echo &quot;After&quot;
        ls -lh
    fi
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="cleanbuilddirectoryonmacosorlinuxworker">
                            <a href="#cleanbuilddirectoryonmacosorlinuxworker">
                                <strong>Step 14.4 -</strong> Clean Build Directory on macOS or Linux Worker
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the <code>{automationWorkerLinuxBaseDirectory}/build-winpe-iso</code> directory.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DIR=&quot;{automationWorkerLinuxBaseDirectory}/build-winpe-iso&quot;
[[ -d ${DIR} ]] &amp;&amp; rm -rf ${DIR} &amp;&amp; echo &quot;Removed ${DIR}&quot; || \
    echo &quot;No directory to remove.&quot;
                </code>
            </pre>
        </div>
    </div>







                    <div class="row pt-5">
                        <div class="col">
                            <h2>Completed</h2>
                            <p>
                                You have completed this instruction.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

<!-- Download Attune Ad -->

            <div class="toc col-lg-2 px-0">
                <div class="container px-0 pt-3 pl-5">
                    <div class="card border-light mb-3" style="max-width: 18rem;">
                        <div class="card-body attune-ad">
                            <img
                                src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                                alt="Attune - Powered by ServerTribe"
                                class="img-fluid">
                            <p class="card-title mt-3 text-center">
                                <strong>Automate with Attune</strong>
                            </p>
                            <p class="card-text text-center">
                                Download the Attune Community Edition.
                            </p>
                            <p class="text-center">
                                <a href="https://www.servertribe.com/download-attune-registration/"
                                   class="btn btn-primary mt-3">
                                    DOWNLOAD!!!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

<!-- Join Discord -->

        <div class="row py-5">
            <div class="jumbotron">
              <h1 class="display-4 text-center">
                  Discuss this Project in Discord
              </h1>
              <p class="lead">

                  Join our Discord channel and connect with like-minded individuals who
                  share your passion. Engage in lively discussions, gain valuable insights,
                  and stay updated on the latest trends in our industry. Don't miss out on
                  this opportunity to network, learn, and grow together.
              </p>
              <hr class="my-4 text-center">
                <div class="col px-0">
                  <p class="text-center">
                      Click the link below and become a part of our vibrant community on
                      Discord today!
                  </p>
                  <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://discord.com/invite/3YpJsagqUn"
                       role="button">
                        Join NOW!!!
                    </a>
                  </p>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Project Footer -->

<footer class="footer fixed-bottom bg-white border-top box-shadow">
      <div class="container px-0">
          <div class="row">
              <div class="col px-0">
                  <a class="my-0 mr-lg-auto"
                     href="https://www.servertribe.com/"
                     target="_blank">
                      <img
                          src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                          alt="Attune - Powered by ServerTribe"
                          class="img-fluid navbar-img">
                  </a>
              </div>
          </div>
      </div>
</footer>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>


</body>
</html>
