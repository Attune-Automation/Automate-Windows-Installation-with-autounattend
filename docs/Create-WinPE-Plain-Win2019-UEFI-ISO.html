
<!doctype html>
<html lang="en">




<head>
    <title>How to Create WinPE Plain Win2019 UEFI ISO - Attune Automation</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="title"
          content="How to Create WinPE Plain Win2019 UEFI ISO - Attune Automation">
    <meta name="description"
          content="">
    <meta name="robots"
          content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large">

    <meta property="og:locale" content="en_AU" />
    <meta property="og:type" content="article" />
    <meta property="og:title"
          content="HowTo Create WinPE Plain Win2019 UEFI ISO - Attune Automation" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="Attune Automation" />
    <meta property="article:section" content="IT Instruction" />

    <meta name="twitter:title"
          content="How to Create WinPE Plain Win2019 UEFI ISO - Attune Automation" />
    <meta name="twitter:description" content="" />

    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-180x180.png">
    <meta name="msapplication-TileImage" content="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-270x270.png">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="styles/style.css">

    <!-- Google tag (gtag.js) -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=G-5TZQZNDJCD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-5TZQZNDJCD');
    </script>
</head>


<body>

<!-- Project NavBar -->

<div class="bg-white border-bottom box-shadow sticky-top mb-3">
<div class="container px-0">
    <div class="row px-0">
        <div class="col d-flex flex-column flex-lg-row align-items-center px-0
            py-3">
            <a class="navbar-brand my-0 mr-lg-auto"
                  href="https://www.servertribe.com/"
                  target="_blank">
                    <img
                        src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                        alt="Attune - Powered by ServerTribe"
                        class="img-fluid navbar-img">
            </a>
            <nav class="my-2 my-lg-0 mr-lg-3">
                <a class="p-2 text-dark" href="http://doc.servertribe.com/"
                   target="_blank">
                    Documentation
                </a>
                <a class="p-2 text-dark"
                   href="https://discord.com/invite/3YpJsagqUn"
                   target="_blank">
                    Discord
                </a>
                <a class="p-2 text-dark" href="https://github.com/Attune-Automation"
                   target="_blank">
                    GitHub
                </a>
                <a class="p-2 text-dark" href="https://www.servertribe.com/learn/"
                   target="_blank">
                    Learn
                </a>
            </nav>
            <a class="btn btn-outline-primary"
               href="https://www.servertribe.com/download-attune-registration/"
               target="_blank">
                Download NOW!
            </a>
        </div>
    </div>
</div></div>

<!-- Project breadcrumbs -->

<!-- Project breadcrumbs -->
<div class="container px-0">
    <div class="row">
        <nav class="col px-0" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="index.html">
                    Automate Windows Installation with autounattend
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <strong>Create WinPE Plain Win2019 UEFI ISO</strong>
                </li>
            </ol>
        </nav>
    </div>
</div>

<!-- Blueprint Header -->

<div class="container px-0">
    <!-- Blueprint name and description -->
    <div class="row">
        <div class="col px-0">
            <h1 class="text-left">
                How to Create WinPE Plain Win2019 UEFI ISO
            </h1>
        </div>
    </div>

<!-- Blueprint Description -->
    <div class="row pt-4">
        <div class="col-6 px-0">
            <h6 class="text-left">
                This documentation is generated by
                <a href="https://www.servertribe.com/"
                    class="badge badge-primary"
                    target="_blank">
                    Attune
                </a>
            </h6>
        </div>
        <div class="col-6 align-self-end text-right px-0">
            <h6 class="text-right">
                <a href="https://www.youtube.com/@servertribe"
                    class="badge badge-secondary"
                    target="_blank">
                    YouTube
                </a>
                <a href="https://github.com/Attune-Automation"
                    class="badge badge-secondary"
                    target="_blank">
                    GitHub
                </a>
                <a href="https://discord.com/invite/3YpJsagqUn"
                    class="badge badge-secondary"
                    target="_blank">
                    Discord
                </a>
                <a href="https://www.linkedin.com/company/servertribe/"
                    class="badge badge-secondary"
                    target="_blank">
                    LinkedIn
                </a>
                <a href="http://doc.servertribe.com/"
                    class="badge badge-secondary"
                    target="_blank">
                    Documentation
                </a>
            </h6>
        </div>
    </div>
    <hr>
</div>

<div class="documentation">
    <div class="container px-0">
        <div class="row">

<!-- Blueprint ToC -->


            <div class="toc col-lg-2 px-0 pr-5">
                <div class="container px-0 pt-3">
                    <p class="pb-2">
                        <strong>Contents</strong>
                    </p>
                    <p class="text-muted">
                        <a href="#top">
                            <strong>Create WinPE Plain Win2019 UEFI ISO</strong>
                        </a>
                    </p>


    
        

                    <p class="text-muted pt-2">
                        <a href="#confirmwinpewin2019plainuefiisodoesnotexist">
                            <strong>Step 1 -</strong> Confirm winpe_win2019_plain_uefi.iso Does Not Exist
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#createwinpecleanbuildfiles">
                            <strong>Step 2 -</strong> Create WinPE Clean Build Files
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#linunmountwindowsiso">
                            <strong>Step 2.1 -</strong> LIN Unmount Windows ISO
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#lindeletewinimgfolder">
                            <strong>Step 2.2 -</strong> LIN Delete winimg Folder
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#lincleanbuilddirectory">
                            <strong>Step 2.3 -</strong> LIN Clean Build Directory
                        </a>
                    </p>


        

                    <p class="text-muted pt-2">
                        <a href="#deploywin2019dvdiso">
                            <strong>Step 3 -</strong> Deploy Win2019 DVD ISO
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#linmountwinserverdvdiso">
                            <strong>Step 4 -</strong> LIN Mount Win Server DVD ISO
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#linextractwinpeisofromwinimgdirectory">
                            <strong>Step 5 -</strong> LIN Extract WinPE ISO from winimg Directory
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#linextractwinpeisotowinpestaging">
                            <strong>Step 6 -</strong> LIN Extract winpe.iso to winpe_staging
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#lincopyfilesformkwinpeimgcompatibilitytowinpestaging">
                            <strong>Step 7 -</strong> LIN Copy Files for mkwinpeimg Compatibility to WinPE Staging
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#linperformdeletesetupexefromwinpestagingbootwim">
                            <strong>Step 8 -</strong> LIN Perform Delete setup.exe from winpe_staging boot.wim
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#lincreatebootwimmountfolder">
                            <strong>Step 8.1 -</strong> LIN Create boot.wim Mount Folder
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#linwimlibmountbootwimtowinpebootimagedirfolder">
                            <strong>Step 8.2 -</strong> LIN wimlib Mount BOOT.WIM to WinPE_BootImageDir Folder
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#lindeletesetupexefrombootwim">
                            <strong>Step 8.3 -</strong> LIN Delete setup.exe from boot.wim
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#linwimlibunmountbootwim">
                            <strong>Step 8.4 -</strong> LIN wimlib Unmount boot.wim
                        </a>
                    </p>


        

                    <p class="text-muted pt-2">
                        <a href="#copywindowsefifilestowinpestaging">
                            <strong>Step 9 -</strong> Copy Windows EFI Files to WinPE Staging
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#performcreatewinpewin2019plainuefiisofromwinpestaging">
                            <strong>Step 10 -</strong> Perform Create winpe_win2019_plain_uefi.iso from winpe_staging
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#changeownershipofwinpestagingfoldertoautomationworkerlinuxuser">
                            <strong>Step 10.1 -</strong> Change Ownership of winpe_staging Folder to automationWorkerLinuxUser
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#createwinpewin2019plainuefiiso">
                            <strong>Step 10.2 -</strong> Create winpe_win2019_plain_uefi.iso
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#mountemptywinpewin2019plainuefiiso">
                            <strong>Step 10.3 -</strong> Mount Empty winpe_win2019_plain_uefi.iso
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#movewinpestagingtouefimount">
                            <strong>Step 10.4 -</strong> Move WinPE Staging to UEFI Mount
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#unmountwinpeuefimount">
                            <strong>Step 10.5 -</strong> Unmount WinPE UEFI Mount
                        </a>
                    </p>


        

                    <p class="text-muted pt-2">
                        <a href="#createwinpecleanbuildfiles">
                            <strong>Step 11 -</strong> Create WinPE Clean Build Files
                        </a>
                    </p>
    
        

                    <p class="text-muted pt-2">
                        <a href="#linunmountwindowsiso">
                            <strong>Step 11.1 -</strong> LIN Unmount Windows ISO
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#lindeletewinimgfolder">
                            <strong>Step 11.2 -</strong> LIN Delete winimg Folder
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#lincleanbuilddirectory">
                            <strong>Step 11.3 -</strong> LIN Clean Build Directory
                        </a>
                    </p>



                </div>
            </div>

<!-- Blueprint Contents -->
            <div class="col-lg-8 pt-3">
                <div class="container">


        <div class="jumbotron">
            <p class="display-3 text-center">
                <strong>Automate This</strong>
            </p>
            <p class="lead text-center">
                Use the <strong>Attune GUI</strong> for your Scripts
            </p>
            <p class="lead">
                <ol>
                    <a href="https://www.servertribe.com/download-attune-registration/"
                        target="_blank">
                        <span class="badge badge-primary">1</span>
                        Download Attune
                        <i class="fa-solid fa-download fa-beat-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://github.com/attune-Automation/"
                        target="_blank">
                        <span class="badge badge-primary">2</span>
                         Copy the Attune Project URL
                         <i class="fa-brands fa-github fa-fade"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://servertribe-attune.readthedocs.io/en/latest/howto/design_workspace/clone_project.html"
                        target="_blank">
                        <span class="badge badge-primary">3</span>
                        Clone the Project in Attune
                         <i class="fa-solid fa-book fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=GCWDI29rDV0"
                        target="_blank">
                        <span class="badge badge-primary">4</span>
                        Plan your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=b7DhFcURkZg"
                        target="_blank">
                        <span class="badge badge-primary">5</span>
                        Run your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
            </p>
            <p class="lead text-center">
                You've automated: <strong>Create WinPE Plain Win2019 UEFI ISO</strong>
            </p>
            <hr class="my-4 text-center">
            <div class="col px-0">
                <p class="text-center">
                    Get the most out of automation with our get started
                    videos, product demonstrations, and more.
                </p>
                <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://www.servertribe.com/learn/"
                       target="_blank"
                       role="button">
                        Learn Attune Automation
                    </a>
                </p>
            </div>
        </div>

        <div class="row">
            <p>The following steps will guide you through the manual process.</p>
        </div>

<!-- Blueprint Steps -->


        



                    <div class="row pt-5">
                        <h3 id="confirmwinpewin2019plainuefiisodoesnotexist">
                            <a href="#confirmwinpewin2019plainuefiisodoesnotexist">
                                <strong>Step 1 -</strong> Confirm winpe_win2019_plain_uefi.iso Does Not Exist
                            </a>
                        </h3>
                    </div>











                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DIRECTORY=&quot;{automationWorkerBaseDirectory}&quot;
cd &quot;${DIRECTORY}&quot;

ISO=&quot;winpe_win2019_plain_uefi.iso&quot;
if [[ -f ${ISO} ]]
then
    echo &quot;Please delete ${DIRECTORY|/${ISO} to confirm you want to try again.&quot;
    exit 1
fi
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="createwinpecleanbuildfiles">
                            <a href="#createwinpecleanbuildfiles">
                                <strong>Step 2 -</strong> Create WinPE Clean Build Files
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="linunmountwindowsiso">
                            <a href="#linunmountwindowsiso">
                                <strong>Step 2.1 -</strong> LIN Unmount Windows ISO
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Unmounts <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/winimg</code>.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
MOUNT_FOLDER=&quot;winimg&quot;
BUILD_DIRECTORY=&quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
MOUNT_PATH=&quot;${BUILD_DIRECTORY}/${MOUNT_FOLDER}&quot;

if df -h | grep --ignore-case \
    --quiet \
    &quot;${MOUNT_PATH}&quot;
then
    cd &quot;${BUILD_DIRECTORY}&quot;

    umount --verbose &quot;${MOUNT_FOLDER}&quot;
else
    echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="lindeletewinimgfolder">
                            <a href="#lindeletewinimgfolder">
                                <strong>Step 2.2 -</strong> LIN Delete winimg Folder
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/winimg</code> folder.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
BUILD_DIRECTORY=&quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
if [ ! -d ${BUILD_DIRECTORY} ]
then
    echo &quot;Directory ${BUILD_DIRECTORY} does not exist. Skipping.&quot;
else
    cd &quot;${BUILD_DIRECTORY}&quot;
        
    DIR=&quot;winimg&quot;
    [[ -d ${DIR} ]] &amp;&amp; rm -rf ${DIR} &amp;&amp; echo &quot;Removed ${DIR}&quot; || \
        echo &quot;No directory to remove.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="lincleanbuilddirectory">
                            <a href="#lincleanbuilddirectory">
                                <strong>Step 2.3 -</strong> LIN Clean Build Directory
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}</code> directory.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DIR=&quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
[[ -d ${DIR} ]] &amp;&amp; rm -rf ${DIR} &amp;&amp; echo &quot;Removed ${DIR}&quot; || \
    echo &quot;No directory to remove.&quot;
                </code>
            </pre>
        </div>
    </div>






        



                    <div class="row pt-5">
                        <h3 id="deploywin2019dvdiso">
                            <a href="#deploywin2019dvdiso">
                                <strong>Step 3 -</strong> Deploy Win2019 DVD ISO
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deploys Windows Server 2019 ISO to <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}</code>.</p>
                            </p>
                        </div>
                    </div>









    

    



    <div class="row">
        <p>
            <p>Download from https://www.microsoft.com/en-us/evalcenter/download-windows-server-2019.</p>
        </p>
        <p>
            Copy the File(s)
            <strong>Windows_Server_201_ISO.tar</strong>
            to the target node.
        </p>
        <p>
            <strong>Deploy the File(s)</strong> here:
        </p>
    </div>
    <div class="row py-1">
        <code class="language-bash">
{automationWorkerBaseDirectory}/build-{newOsNode.fqn}, relative to the home directory
        </code>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="linmountwinserverdvdiso">
                            <a href="#linmountwinserverdvdiso">
                                <strong>Step 4 -</strong> LIN Mount Win Server DVD ISO
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Mounts the Windows Server ISO to <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/winimg</code>.</p>
<p><code>winimg</code> stands for Windows Image.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
FOLDER=&quot;winimg&quot;
mkdir -p &quot;${FOLDER}&quot;

# Case insensitve globbing
shopt -s nocaseglob

ISO=$(ls *SERVER*.iso)

mount --options &quot;uid={automationWorkerLinuxUser.user}&quot; \
    --options &quot;gid={automationWorkerLinuxUser.user}&quot; \
    &quot;${ISO}&quot; &quot;${FOLDER}&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="linextractwinpeisofromwinimgdirectory">
                            <a href="#linextractwinpeisofromwinimgdirectory">
                                <strong>Step 5 -</strong> LIN Extract WinPE ISO from winimg Directory
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Extracts the WinPE image from Windows Server 2019 <code>boot.wim</code> by default at index 2.</p>
<p>Writes this out to <code>winpe.iso</code>.</p>
<p>This is the exact copy of Windows Server 2019's WinPE image which by default will run <code>setup.exe</code> on the Windows Desktop ISO at a higher priority than running <code>startnet.cmd</code>.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
    
mkwinpeimg --iso --windows-dir=winimg \
    &quot;winpe.iso&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="linextractwinpeisotowinpestaging">
                            <a href="#linextractwinpeisotowinpestaging">
                                <strong>Step 6 -</strong> LIN Extract winpe.iso to winpe_staging
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Extract <code>winpe.iso</code> to a <code>winpe_staging</code> folder.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerBaseDirectory}/build-{newOsNode.fqn}

FOLDER=winpe_staging
mkdir -p &quot;${FOLDER}&quot;

7z x winpe.iso -o&quot;${FOLDER}&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="lincopyfilesformkwinpeimgcompatibilitytowinpestaging">
                            <a href="#lincopyfilesformkwinpeimgcompatibilitytowinpestaging">
                                <strong>Step 7 -</strong> LIN Copy Files for mkwinpeimg Compatibility to WinPE Staging
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>This copies <code>boot/etfsboot.com</code> from the Windows Server 2019 ISO to WinPE's <code>BOOT</code> folder.</p>
<p>This is needed if the WinPE ISO needs to work with future usages with <code>mkwinpeimg</code>.</p>
<p>Otherwise this step is not needed.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;

cp --verbose &quot;winimg/boot/etfsboot.com&quot; &quot;winpe_staging/BOOT&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="linperformdeletesetupexefromwinpestagingbootwim">
                            <a href="#linperformdeletesetupexefromwinpestagingbootwim">
                                <strong>Step 8 -</strong> LIN Perform Delete setup.exe from winpe_staging boot.wim
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes <code>setup.exe</code> from the extracted WinPE's <code>boot.img</code> at index 2 of the Windows Server 2019 ISO.</p>
<p>By default Windows Server 2019 <code>boot.img</code> contains <code>setup.exe</code> which was designed to work with calling <code>setup.exe</code> which exists at index 1 of Windows Server 2019 image.</p>
<p>As the <code>winpe_staging</code> folder will be used to recreate a WinPE BIOS ISO designed to work with a Samba drive which contains the required <code>setup.exe</code> for these versions of Windows below we no longer need the <code>setup.exe</code> on the WinPE <code>boot.img</code>:</p>
<ol>
<li>Windows Desktop 10</li>
<li>Windows Server 2016</li>
<li>Windows Server 2019</li>
<li>Windows Server 2022</li>
</ol>
                            </p>
                        </div>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="lincreatebootwimmountfolder">
                            <a href="#lincreatebootwimmountfolder">
                                <strong>Step 8.1 -</strong> LIN Create boot.wim Mount Folder
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Creates a directory <code>WinPE_BootImageDir</code> for mounting <code>winpe_staging/SOURCES/BOOT.WIM</code>.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerBaseDirectory}/build-{newOsNode.fqn}

WinPE_BootImageDir=&quot;WinPE_BootImageDir&quot;
if [ ! -d WinPE_BootImageDir ]
then
    mkdir $WinPE_BootImageDir
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="linwimlibmountbootwimtowinpebootimagedirfolder">
                            <a href="#linwimlibmountbootwimtowinpebootimagedirfolder">
                                <strong>Step 8.2 -</strong> LIN wimlib Mount BOOT.WIM to WinPE_BootImageDir Folder
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Mounts <code>winpe_staging/SOURCES/BOOT.WIM</code> to <code>WinPE_BootImageDir</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerBaseDirectory}/build-{newOsNode.fqn}
wimmountrw winpe_staging/SOURCES/BOOT.WIM WinPE_BootImageDir
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="lindeletesetupexefrombootwim">
                            <a href="#lindeletesetupexefrombootwim">
                                <strong>Step 8.3 -</strong> LIN Delete setup.exe from boot.wim
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes <code>setup.exe</code> from <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/WinPE_BootImageDir</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerBaseDirectory}/build-{newOsNode.fqn}/WinPE_BootImageDir

rm --verbose setup.exe
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="linwimlibunmountbootwim">
                            <a href="#linwimlibunmountbootwim">
                                <strong>Step 8.4 -</strong> LIN wimlib Unmount boot.wim
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Unmounts <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/WinPE_BootImageDir</code>.</p>
<p>This will write out changes back into <code>winpe_staging/SOURCES/BOOT.WIM</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd {automationWorkerBaseDirectory}/build-{newOsNode.fqn}
wimunmount WinPE_BootImageDir --commit --check --rebuild
                </code>
            </pre>
        </div>
    </div>






        



                    <div class="row pt-5">
                        <h3 id="copywindowsefifilestowinpestaging">
                            <a href="#copywindowsefifilestowinpestaging">
                                <strong>Step 9 -</strong> Copy Windows EFI Files to WinPE Staging
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Relative to the <code>{ksAttuneBaseDir}/build-{kickstartedNode.fqn/winpe</code> directory, copies the EFI files in <code>winimg/efi</code>to <code>winpe_staging</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;

# Copy EFI Files from Windows ISO
cp -rv &quot;winimg/efi&quot; &quot;winpe_staging&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="performcreatewinpewin2019plainuefiisofromwinpestaging">
                            <a href="#performcreatewinpewin2019plainuefiisofromwinpestaging">
                                <strong>Step 10 -</strong> Perform Create winpe_win2019_plain_uefi.iso from winpe_staging
                            </a>
                        </h3>
                    </div>






    




    



                    <div class="row pt-5">
                        <h4 id="changeownershipofwinpestagingfoldertoautomationworkerlinuxuser">
                            <a href="#changeownershipofwinpestagingfoldertoautomationworkerlinuxuser">
                                <strong>Step 10.1 -</strong> Change Ownership of winpe_staging Folder to automationWorkerLinuxUser
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Change the ownership of <code>winpe_staging</code>to <code>automationWorkerLinuxUser.user</code>.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;

# Copy EFI Files from Windows ISO
chown --recursive \
    &quot;{automationWorkerLinuxUser.user}:{automationWorkerLinuxUser.user}&quot; \
    &quot;winpe_staging&quot;
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="createwinpewin2019plainuefiiso">
                            <a href="#createwinpewin2019plainuefiiso">
                                <strong>Step 10.2 -</strong> Create winpe_win2019_plain_uefi.iso
                            </a>
                        </h4>
                    </div>











                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;

bytes=$(du --summarize winpe_staging | awk &#x27;{print $1}&#x27;)
((bytes=bytes+10000))

mkfs.msdos -C &quot;../winpe_win2019_plain_uefi.iso&quot; &quot;${bytes}&quot;
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="mountemptywinpewin2019plainuefiiso">
                            <a href="#mountemptywinpewin2019plainuefiiso">
                                <strong>Step 10.3 -</strong> Mount Empty winpe_win2019_plain_uefi.iso
                            </a>
                        </h4>
                    </div>










    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;

mkdir --parents --verbose uefi_mount

mount &quot;../winpe_win2019_plain_uefi.iso&quot; uefi_mount
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="movewinpestagingtouefimount">
                            <a href="#movewinpestagingtouefimount">
                                <strong>Step 10.4 -</strong> Move WinPE Staging to UEFI Mount
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Relative to the <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}</code> directory, this step moves the contents of <code>winpe_staging</code> to <code>uefi_mount</code>.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuserroot}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd &quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;

# Copy WinPE Files from WinPE ISO
mv --verbose winpe_staging/* &quot;uefi_mount&quot;
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="unmountwinpeuefimount">
                            <a href="#unmountwinpeuefimount">
                                <strong>Step 10.5 -</strong> Unmount WinPE UEFI Mount
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Unmounts <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/uefi_mount</code>. This writes back contents of <code>uefi_mount</code> to the MSDOS ISO <code>{automationWorkerBaseDirectory}/kickstart_{newOsNode.fqn}.iso</code> created in step <code>Create Empty UEFI for WinPE ISO</code>. </p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
MOUNT_FOLDER=&quot;uefi_mount&quot;
BUILD_PATH=&quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;

MOUNT_PATH=&quot;${BUILD_PATH}/${MOUNT_FOLDER}&quot;

if df -h | grep --ignore-case \
    --quiet \
    &quot;${MOUNT_PATH}&quot;
then

    cd &quot;${BUILD_PATH}&quot;
    
    umount --verbose &quot;${MOUNT_FOLDER}&quot;
else
    echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
fi
                </code>
            </pre>
        </div>
    </div>






        



                    <div class="row pt-5">
                        <h3 id="createwinpecleanbuildfiles">
                            <a href="#createwinpecleanbuildfiles">
                                <strong>Step 11 -</strong> Create WinPE Clean Build Files
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="linunmountwindowsiso">
                            <a href="#linunmountwindowsiso">
                                <strong>Step 11.1 -</strong> LIN Unmount Windows ISO
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Unmounts <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/winimg</code>.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
MOUNT_FOLDER=&quot;winimg&quot;
BUILD_DIRECTORY=&quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
MOUNT_PATH=&quot;${BUILD_DIRECTORY}/${MOUNT_FOLDER}&quot;

if df -h | grep --ignore-case \
    --quiet \
    &quot;${MOUNT_PATH}&quot;
then
    cd &quot;${BUILD_DIRECTORY}&quot;

    umount --verbose &quot;${MOUNT_FOLDER}&quot;
else
    echo &quot;${MOUNT_PATH} is not mounted. Skipping.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="lindeletewinimgfolder">
                            <a href="#lindeletewinimgfolder">
                                <strong>Step 11.2 -</strong> LIN Delete winimg Folder
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}/winimg</code> folder.</p>
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {automationworkerlinuxuser}@{automationworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
BUILD_DIRECTORY=&quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
if [ ! -d ${BUILD_DIRECTORY} ]
then
    echo &quot;Directory ${BUILD_DIRECTORY} does not exist. Skipping.&quot;
else
    cd &quot;${BUILD_DIRECTORY}&quot;
        
    DIR=&quot;winimg&quot;
    [[ -d ${DIR} ]] &amp;&amp; rm -rf ${DIR} &amp;&amp; echo &quot;Removed ${DIR}&quot; || \
        echo &quot;No directory to remove.&quot;
fi
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="lincleanbuilddirectory">
                            <a href="#lincleanbuilddirectory">
                                <strong>Step 11.3 -</strong> LIN Clean Build Directory
                            </a>
                        </h4>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                <p>Deletes the <code>{automationWorkerBaseDirectory}/build-{newOsNode.fqn}</code> directory.</p>
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DIR=&quot;{automationWorkerBaseDirectory}/build-{newOsNode.fqn}&quot;
[[ -d ${DIR} ]] &amp;&amp; rm -rf ${DIR} &amp;&amp; echo &quot;Removed ${DIR}&quot; || \
    echo &quot;No directory to remove.&quot;
                </code>
            </pre>
        </div>
    </div>







                    <div class="row pt-5">
                        <div class="col">
                            <h2>Completed</h2>
                            <p>
                                You have completed this instruction.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

<!-- Download Attune Ad -->

            <div class="toc col-lg-2 px-0">
                <div class="container px-0 pt-3 pl-5">
                    <div class="card border-light mb-3" style="max-width: 18rem;">
                        <div class="card-body attune-ad">
                            <img
                                src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                                alt="Attune - Powered by ServerTribe"
                                class="img-fluid">
                            <p class="card-title mt-3 text-center">
                                <strong>Automate with Attune</strong>
                            </p>
                            <p class="card-text text-center">
                                Download the Attune Community Edition.
                            </p>
                            <p class="text-center">
                                <a href="https://www.servertribe.com/download-attune-registration/"
                                   class="btn btn-primary mt-3">
                                    DOWNLOAD!!!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

<!-- Join Discord -->

        <div class="row py-5">
            <div class="jumbotron">
              <h1 class="display-4 text-center">
                  Discuss this Project in Discord
              </h1>
              <p class="lead">

                  Join our Discord channel and connect with like-minded individuals who
                  share your passion. Engage in lively discussions, gain valuable insights,
                  and stay updated on the latest trends in our industry. Don't miss out on
                  this opportunity to network, learn, and grow together.
              </p>
              <hr class="my-4 text-center">
                <div class="col px-0">
                  <p class="text-center">
                      Click the link below and become a part of our vibrant community on
                      Discord today!
                  </p>
                  <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://discord.com/invite/3YpJsagqUn"
                       role="button">
                        Join NOW!!!
                    </a>
                  </p>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Project Footer -->

<footer class="footer fixed-bottom bg-white border-top box-shadow">
      <div class="container px-0">
          <div class="row">
              <div class="col px-0">
                  <a class="my-0 mr-lg-auto"
                     href="https://www.servertribe.com/"
                     target="_blank">
                      <img
                          src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                          alt="Attune - Powered by ServerTribe"
                          class="img-fluid navbar-img">
                  </a>
              </div>
          </div>
      </div>
</footer>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>


</body>
</html>
