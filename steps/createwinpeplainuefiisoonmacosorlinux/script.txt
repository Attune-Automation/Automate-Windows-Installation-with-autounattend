cd "{automationWorkerLinuxBaseDirectory}/build-winpe-iso"

ISO="{automationWorkerLinuxBaseDirectory}/winpe_plain_uefi.iso"
[ -f "${ISO}" ] && rm -rf "${ISO}"

if [[ -f /etc/redhat-release ]] || [[ -f /etc/lsb-release ]] || [[ -f /etc/debian_version ]]
then
    
    mkisofs \
        -allow-limited-size \
        -iso-level 4 \
        -full-iso9660-filenames \
        -rock \
        -b BOOT/etfsboot.com \
        -no-emul-boot \
        -boot-load-seg 0 \
        -boot-load-size 8 \
        -hide boot.catalog \
        -eltorito-alt-boot \
        -no-emul-boot \
        -b efi/microsoft/boot/efisys.bin \
        -boot-load-size 1 \
        -udf \
        -untranslated-filenames \
        -disable-deep-relocation \
        -V "KS_WIN" \
        -o "${ISO}" \
        winpe_uefi_staging
        
        exit 1
    
elif [[ "Darwin" == "$(uname)" ]]
then

    hdiutil makehybrid \
        -iso -joliet -o ${ISO} winpe_uefi_staging \
        -eltorito-boot boot.img -no-emul-boot
    ls -ltrh ${ISO}
    
else

    echo "Unsupported operating system."
    exit 1
fi